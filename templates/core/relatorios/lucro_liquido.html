{% extends 'base.html' %}

{% block title %}Lucro Líquido - Relatórios{% endblock %}
{% block page_title %}Lucro Líquido Real{% endblock %}

{% block extra_css %}
<style>
    .filtros-card {
        background: white;
        border-radius: 12px;
        padding: 20px;
        margin-bottom: 20px;
        box-shadow: 0 2px 8px rgba(0,0,0,0.08);
    }
    body.dark-mode .filtros-card { background: #2d2d2d; }
    
    .dre-card {
        background: white;
        border-radius: 12px;
        padding: 25px;
        box-shadow: 0 2px 8px rgba(0,0,0,0.08);
    }
    body.dark-mode .dre-card { background: #2d2d2d; }
    
    .dre-linha {
        display: flex;
        justify-content: space-between;
        padding: 12px 0;
        border-bottom: 1px solid #e2e8f0;
    }
    body.dark-mode .dre-linha { border-bottom-color: #444; }
    
    .dre-linha.destaque {
        background: #f8fafc;
        margin: 0 -25px;
        padding: 12px 25px;
        font-weight: 700;
    }
    body.dark-mode .dre-linha.destaque { background: #1e1e1e; }
    
    .dre-linha.total {
        background: #3b82f6;
        color: white;
        margin: 15px -25px -25px -25px;
        padding: 15px 25px;
        border-radius: 0 0 12px 12px;
        font-weight: 700;
        font-size: 1.1rem;
    }
    .dre-linha.total.negativo { background: #ef4444; }
    
    .dre-label { color: #64748b; }
    .dre-valor { font-weight: 600; }
    .dre-valor.positivo { color: #22c55e; }
    .dre-valor.negativo { color: #ef4444; }
    
    .dre-sublinha {
        padding-left: 20px;
        font-size: 0.9rem;
    }
    
    .btn-voltar { margin-bottom: 15px; }
</style>
{% endblock %}

{% block content %}
<a href="{% url 'relatorios' %}" class="btn btn-outline-secondary btn-voltar">
    <i class="bi bi-arrow-left"></i> Voltar aos Relatórios
</a>

<!-- Filtros -->
<div class="filtros-card">
    <form method="get" class="row g-3 align-items-end">
        <div class="col-md-4">
            <label class="form-label">Data Início</label>
            <input type="date" name="data_inicio" class="form-control" value="{{ data_inicio|date:'Y-m-d' }}">
        </div>
        <div class="col-md-4">
            <label class="form-label">Data Fim</label>
            <input type="date" name="data_fim" class="form-control" value="{{ data_fim|date:'Y-m-d' }}">
        </div>
        <div class="col-md-4">
            <button type="submit" class="btn btn-primary w-100">
                <i class="bi bi-calculator"></i> Calcular
            </button>
        </div>
    </form>
</div>

<!-- DRE -->
<div class="dre-card">
    <h5 class="mb-4"><i class="bi bi-file-earmark-spreadsheet me-2"></i>Demonstrativo de Resultado</h5>
    
    <div class="dre-linha">
        <span class="dre-label"><i class="bi bi-cash-stack me-2"></i>Faturamento Bruto</span>
        <span class="dre-valor">R$ {{ faturamento|floatformat:2 }}</span>
    </div>
    
    <div class="dre-linha dre-sublinha">
        <span class="dre-label">(-) Custo das Mercadorias (CMV)</span>
        <span class="dre-valor negativo">- R$ {{ custo_mercadorias|floatformat:2 }}</span>
    </div>
    
    <div class="dre-linha destaque">
        <span><i class="bi bi-arrow-right me-2"></i>Lucro Bruto</span>
        <span class="{% if lucro_bruto >= 0 %}positivo{% else %}negativo{% endif %}">R$ {{ lucro_bruto|floatformat:2 }}</span>
    </div>
    
    <div class="dre-linha dre-sublinha">
        <span class="dre-label">(-) Taxas de Cartão</span>
        <span class="dre-valor negativo">- R$ {{ taxas_cartao|floatformat:2 }}</span>
    </div>
    
    <div class="dre-linha dre-sublinha">
        <span class="dre-label">(-) Despesas Fixas (proporcional)</span>
        <span class="dre-valor negativo">- R$ {{ despesas_fixas|floatformat:2 }}</span>
    </div>
    
    <div class="dre-linha dre-sublinha">
        <span class="dre-label">(-) Despesas Variáveis</span>
        <span class="dre-valor negativo">- R$ {{ despesas_variaveis|floatformat:2 }}</span>
    </div>
    
    <div class="dre-linha dre-sublinha">
        <span class="dre-label">(-) Impostos (Simples {{ aliquota }}%)</span>
        <span class="dre-valor negativo">- R$ {{ impostos|floatformat:2 }}</span>
    </div>
    
    <div class="dre-linha destaque">
        <span><i class="bi bi-dash-circle me-2"></i>Total Deduções</span>
        <span class="negativo">- R$ {{ total_deducoes|floatformat:2 }}</span>
    </div>
    
    <div class="dre-linha total {% if lucro_liquido < 0 %}negativo{% endif %}">
        <span><i class="bi bi-trophy me-2"></i>LUCRO LÍQUIDO</span>
        <span>R$ {{ lucro_liquido|floatformat:2 }}</span>
    </div>
</div>

<!-- Margem -->
<div class="alert {% if margem_liquida >= 0 %}alert-success{% else %}alert-danger{% endif %} mt-3">
    <i class="bi bi-percent me-2"></i>
    <strong>Margem Líquida:</strong> {{ margem_liquida|floatformat:1 }}%
</div>
{% endblock %}