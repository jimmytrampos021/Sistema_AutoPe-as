{% extends 'base.html' %}

{% block title %}Configuração Fiscal{% endblock %}
{% block page_title %}Configuração Fiscal{% endblock %}

{% block extra_css %}
<style>
    .config-card {
        background: white;
        border-radius: 12px;
        padding: 25px;
        box-shadow: 0 2px 8px rgba(0,0,0,0.08);
        margin-bottom: 20px;
    }
    body.dark-mode .config-card { background: #2d2d2d; }
    
    .config-card h5 {
        border-bottom: 2px solid #3b82f6;
        padding-bottom: 10px;
        margin-bottom: 20px;
    }
    
    .btn-voltar { margin-bottom: 15px; }
    
    .help-text { font-size: 0.85rem; color: #718096; }
</style>
{% endblock %}

{% block content %}
<a href="{% url 'fiscal:dashboard' %}" class="btn btn-outline-secondary btn-voltar">
    <i class="bi bi-arrow-left"></i> Voltar
</a>

<form method="post" enctype="multipart/form-data">
    {% csrf_token %}
    
    <!-- Dados da Empresa -->
    <div class="config-card">
        <h5><i class="bi bi-building me-2"></i>Dados da Empresa</h5>
        <div class="row g-3">
            <div class="col-md-6">
                <label class="form-label">Razão Social *</label>
                <input type="text" name="razao_social" class="form-control" required
                       value="{{ config.razao_social|default:'' }}">
            </div>
            <div class="col-md-6">
                <label class="form-label">Nome Fantasia *</label>
                <input type="text" name="nome_fantasia" class="form-control" required
                       value="{{ config.nome_fantasia|default:'' }}">
            </div>
            <div class="col-md-4">
                <label class="form-label">CNPJ *</label>
                <input type="text" name="cnpj" class="form-control" required
                       value="{{ config.cnpj|default:'' }}" placeholder="00.000.000/0000-00">
            </div>
            <div class="col-md-4">
                <label class="form-label">Inscrição Estadual *</label>
                <input type="text" name="inscricao_estadual" class="form-control" required
                       value="{{ config.inscricao_estadual|default:'' }}">
            </div>
            <div class="col-md-4">
                <label class="form-label">Inscrição Municipal</label>
                <input type="text" name="inscricao_municipal" class="form-control"
                       value="{{ config.inscricao_municipal|default:'' }}">
            </div>
        </div>
    </div>
    
    <!-- Endereço -->
    <div class="config-card">
        <h5><i class="bi bi-geo-alt me-2"></i>Endereço</h5>
        <div class="row g-3">
            <div class="col-md-3">
                <label class="form-label">CEP *</label>
                <input type="text" name="cep" class="form-control" required
                       value="{{ config.cep|default:'' }}" placeholder="00000-000">
            </div>
            <div class="col-md-7">
                <label class="form-label">Logradouro *</label>
                <input type="text" name="logradouro" class="form-control" required
                       value="{{ config.logradouro|default:'' }}">
            </div>
            <div class="col-md-2">
                <label class="form-label">Número *</label>
                <input type="text" name="numero" class="form-control" required
                       value="{{ config.numero|default:'' }}">
            </div>
            <div class="col-md-3">
                <label class="form-label">Complemento</label>
                <input type="text" name="complemento" class="form-control"
                       value="{{ config.complemento|default:'' }}">
            </div>
            <div class="col-md-3">
                <label class="form-label">Bairro *</label>
                <input type="text" name="bairro" class="form-control" required
                       value="{{ config.bairro|default:'' }}">
            </div>
            <div class="col-md-3">
                <label class="form-label">Cidade *</label>
                <input type="text" name="cidade" class="form-control" required
                       value="{{ config.cidade|default:'' }}">
            </div>
            <div class="col-md-1">
                <label class="form-label">UF *</label>
                <select name="uf" class="form-select" required>
                    {% for sigla, nome in ufs %}
                    <option value="{{ sigla }}" {% if config.uf == sigla %}selected{% endif %}>{{ sigla }}</option>
                    {% endfor %}
                </select>
            </div>
            <div class="col-md-2">
                <label class="form-label">Cód. IBGE *</label>
                <input type="text" name="codigo_municipio" class="form-control" required
                       value="{{ config.codigo_municipio|default:'' }}" placeholder="7 dígitos">
                <div class="help-text">Código IBGE do município</div>
            </div>
        </div>
    </div>
    
    <!-- Contato -->
    <div class="config-card">
        <h5><i class="bi bi-envelope me-2"></i>Contato</h5>
        <div class="row g-3">
            <div class="col-md-4">
                <label class="form-label">Telefone</label>
                <input type="text" name="telefone" class="form-control"
                       value="{{ config.telefone|default:'' }}" placeholder="(00) 00000-0000">
            </div>
            <div class="col-md-8">
                <label class="form-label">Email (para envio de notas) *</label>
                <input type="email" name="email" class="form-control" required
                       value="{{ config.email|default:'' }}">
            </div>
        </div>
    </div>
    
    <!-- Configurações Fiscais -->
    <div class="config-card">
        <h5><i class="bi bi-gear me-2"></i>Configurações Fiscais</h5>
        <div class="row g-3">
            <div class="col-md-6">
                <label class="form-label">Regime Tributário *</label>
                <select name="regime_tributario" class="form-select" required>
                    <option value="1" {% if config.regime_tributario == '1' %}selected{% endif %}>Simples Nacional</option>
                    <option value="2" {% if config.regime_tributario == '2' %}selected{% endif %}>Simples Nacional - Excesso de Sublimite</option>
                    <option value="3" {% if config.regime_tributario == '3' %}selected{% endif %}>Regime Normal</option>
                </select>
            </div>
            <div class="col-md-6">
                <label class="form-label">Ambiente *</label>
                <select name="ambiente" class="form-select" required>
                    <option value="2" {% if config.ambiente == '2' %}selected{% endif %}>Homologação (Teste)</option>
                    <option value="1" {% if config.ambiente == '1' %}selected{% endif %}>Produção</option>
                </select>
                <div class="help-text">Comece em Homologação para testar. Mude para Produção quando estiver pronto.</div>
            </div>
        </div>
    </div>
    
    <!-- Certificado Digital -->
    <div class="config-card">
        <h5><i class="bi bi-shield-lock me-2"></i>Certificado Digital A1</h5>
        <div class="row g-3">
            <div class="col-md-4">
                <label class="form-label">Arquivo do Certificado (.pfx)</label>
                <input type="file" name="certificado_arquivo" class="form-control" accept=".pfx,.p12">
                {% if config.certificado_arquivo %}
                <div class="help-text text-success mt-1">
                    <i class="bi bi-check-circle"></i> Certificado já cadastrado
                </div>
                {% endif %}
            </div>
            <div class="col-md-4">
                <label class="form-label">Senha do Certificado</label>
                <input type="password" name="certificado_senha" class="form-control"
                       value="{{ config.certificado_senha|default:'' }}">
            </div>
            <div class="col-md-4">
                <label class="form-label">Validade do Certificado</label>
                <input type="date" name="certificado_validade" class="form-control"
                       value="{{ config.certificado_validade|date:'Y-m-d' }}">
            </div>
        </div>
    </div>
    
    <!-- API WebmaniaBR -->
    <div class="config-card">
        <h5><i class="bi bi-cloud me-2"></i>API WebmaniaBR</h5>
        <p class="text-muted mb-3">
            Obtenha suas credenciais em <a href="https://webmaniabr.com" target="_blank">webmaniabr.com</a>
        </p>
        <div class="row g-3">
            <div class="col-md-6">
                <label class="form-label">Consumer Key</label>
                <input type="text" name="webmania_consumer_key" class="form-control"
                       value="{{ config.webmania_consumer_key|default:'' }}">
            </div>
            <div class="col-md-6">
                <label class="form-label">Consumer Secret</label>
                <input type="text" name="webmania_consumer_secret" class="form-control"
                       value="{{ config.webmania_consumer_secret|default:'' }}">
            </div>
            <div class="col-md-6">
                <label class="form-label">Access Token</label>
                <input type="text" name="webmania_access_token" class="form-control"
                       value="{{ config.webmania_access_token|default:'' }}">
            </div>
            <div class="col-md-6">
                <label class="form-label">Access Token Secret</label>
                <input type="text" name="webmania_access_token_secret" class="form-control"
                       value="{{ config.webmania_access_token_secret|default:'' }}">
            </div>
        </div>
    </div>
    
    <!-- NFC-e -->
    <div class="config-card">
        <h5><i class="bi bi-receipt me-2"></i>NFC-e (Nota de Consumidor)</h5>
        <div class="row g-3">
            <div class="col-md-3">
                <label class="form-label">ID do CSC</label>
                <input type="text" name="csc_id" class="form-control"
                       value="{{ config.csc_id|default:'' }}">
                <div class="help-text">Fornecido pela SEFAZ</div>
            </div>
            <div class="col-md-5">
                <label class="form-label">Token CSC</label>
                <input type="text" name="csc_token" class="form-control"
                       value="{{ config.csc_token|default:'' }}">
            </div>
            <div class="col-md-2">
                <label class="form-label">Série NFC-e</label>
                <input type="number" name="serie_nfce" class="form-control" min="1"
                       value="{{ config.serie_nfce|default:1 }}">
            </div>
            <div class="col-md-2">
                <label class="form-label">Série NF-e</label>
                <input type="number" name="serie_nfe" class="form-control" min="1"
                       value="{{ config.serie_nfe|default:1 }}">
            </div>
        </div>
    </div>
    
    <!-- Botões -->
    <div class="d-flex gap-2">
        <button type="submit" class="btn btn-primary btn-lg">
            <i class="bi bi-check-lg me-2"></i>Salvar Configurações
        </button>
        <a href="{% url 'fiscal:dashboard' %}" class="btn btn-outline-secondary btn-lg">Cancelar</a>
    </div>
</form>
{% endblock %}
